---
title: é«˜é˜¶å‡½æ•°
---

# é«˜é˜¶å‡½æ•°

æ‰€è°“é«˜é˜¶å‡½æ•°ï¼Œæ˜¯æŒ‡ä½¿ç”¨å…¶ä»–å‡½æ•°ä½œä¸ºå‚æ•°ã€æˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°ä½œä¸ºç»“æœçš„å‡½æ•°

## å‡½æ•°ä½œä¸ºå‚æ•°

å¸¸ç”¨çš„æ•°ç»„æ–¹æ³•ï¼Œæ¯”å¦‚ map/reduce/filter/sort ç­‰ã€‚

## é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP) è§£å†³äº†ä»€ä¹ˆé—®é¢˜

### ä½¿ç”¨ AOP ä¹‹å‰

æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œç¬¬ä¸€å¤©ï¼Œäº§å“è¯´ï¼šç°åœ¨éœ€è¦åœ¨è®¢å•æäº¤å‰åï¼Œå¢åŠ ç»Ÿè®¡æ—¶é—´çš„åŠŸèƒ½ï¼Œæœ‰æ²¡æœ‰éš¾åº¦ï¼Ÿå½“ç„¶æ²¡æœ‰ï¼Œå‡ è¡Œä»£ç ï¼Œè½»æ¾æå®š ğŸ‘Œ

```js
let submitOrder = () => {
  let nowTime = +new Date();
  console.log('æäº¤è®¢å• å¼€å§‹è®¡æ—¶', nowTime);
  /*æäº¤è®¢å• åŸé€»è¾‘*/
  let spendTime = +new Date() - nowTime;
  console.log('æäº¤è®¢å• è€—æ—¶è®¡ç®—', spendTime);
};
```

ç¬¬äºŒå¤©ï¼Œäº§å“è¯´ï¼šè®¢å•æäº¤å‰åï¼Œå†åŠ ä¸ªåŸ‹ç‚¹å§ï¼Œæœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿå½“ç„¶æ²¡æœ‰ï¼Œå†åŠ å‡ è¡Œã€‚ã€‚  
éšç€ä¸ç¡®å®šéœ€æ±‚å¢åŠ ï¼Œä»£ç è¶Šæ¥è¶Šé•¿ã€‚é•¿å€’è¿˜å¥½ï¼Œå…³é”®éƒ¨åˆ†é€»è¾‘æ‰åœ¨ä¸€å—ï¼Œå‰ªä¸æ–­ç†è¿˜ä¹±~  
æˆ‘ä»¬å¯èƒ½éƒ½æ²¡æ³¨æ„ï¼Œå‡½æ•°çš„åå­—æ˜¯ submitOrderï¼Œä½†æ˜¯è¿™ä¹Ÿå¤ªä¸ä¸“ä¸€äº†ã€‚è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„æµ·ç‹å‡½æ•°å§~

> æœ¬ä»¥ä¸ºæ¸¸è¿›äº†å“¥å“¥çš„é±¼å¡˜ï¼Œæ²¡æƒ³åˆ°å“¥å“¥æ˜¯ä¸ªæµ·ç‹ ğŸ˜

```js
let submitOrder = () => {
  const nowTime = +new Date();
  // ç»§ç»­å¢åŠ æäº¤å‰åº“å­˜æ ¡éªŒ
  // ç»§ç»­å¢åŠ ...
  console.log('æäº¤è®¢å•ä¹‹å‰ æ•°æ®ä¸ŠæŠ¥');
  console.log('æäº¤è®¢å• åŸé€»è¾‘');
  // ç»§ç»­å¢åŠ å¤±è´¥ç»Ÿè®¡
  // ç»§ç»­å¢åŠ ...
  const spendTime = +new Date() - nowTime;
  console.log(spendTime);
  console.log('æäº¤è®¢å•ä¹‹å å†æ¬¡æ•°æ®ä¸ŠæŠ¥');
};
```

### AOP ç™»åœº

è¿˜æ˜¯ä¸Šé¢è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬æ˜¯ç”¨ AOP çš„æ€æƒ³å®ç°ä¸€ä¸‹ï¼Œå…ˆè¯·å‡ºä¸»è§’ï¼Œ2 ä¸ªåˆ‡é¢å‡½æ•°

> åœ¨åŸå‹é“¾ä¸Šå¢åŠ æˆ–ä¿®æ”¹æ–¹æ³•ï¼Œéœ€è¦è°¨æ…ã€‚å› ä¸ºæ˜¯å…¨å±€çš„ï¼Œæœ‰å¯èƒ½ä¼šå†²çªï¼Œè€Œä¸”é—®é¢˜ä¸å¥½æ’æŸ¥ã€‚

```js
Function.prototype.before = function(beforefn) {
  var self = this; // ä¿å­˜åŸå‡½æ•°çš„å¼•ç”¨
  return function() {
    // è¿”å›åŒ…å«äº†åŸå‡½æ•°å’Œæ–°å‡½æ•°çš„"ä»£ç†"å‡½æ•° functionæ‹¥æœ‰before/afteræ–¹æ³•
    beforefn.apply(this, arguments); // æ‰§è¡Œæ–°å‡½æ•°ï¼Œä¿®æ­£ this
    return self.apply(this, arguments); // æ‰§è¡ŒåŸå‡½æ•°
  };
};
Function.prototype.after = function(afterfn) {
  var self = this;
  return function() {
    // æ‰§è¡ŒåŸå‡½æ•°
    var ret = self.apply(this, arguments);
    // æ‰§è¡Œafter
    afterfn.apply(this, arguments);
    // è¿”å›åŸå‡½æ•°çš„è¿”å›å€¼
    return ret;
  };
};
```

ä¿®æ”¹åçš„æ•ˆæœ

```js
let submitOrder = () => {
  console.log('æäº¤è®¢å• åŸé€»è¾‘');
};

// æ—¶é—´ç»Ÿè®¡å‡½æ•°
const timeLog = fn => {
  let nowTime;
  return fn
    .before(() => {
      nowTime = +new Date();
      console.log('æäº¤è®¢å• å¼€å§‹è®¡æ—¶', nowTime);
    })
    .after(() => {
      const spendTime = +new Date() - nowTime;
      console.log('æäº¤è®¢å• è€—æ—¶è®¡ç®—', spendTime);
      return this;
    });
};

const reportLog = fn => {
  return fn
    .before(() => {
      console.log('æäº¤è®¢å•ä¹‹å‰ æ•°æ®ä¸ŠæŠ¥');
    })
    .after(() => {
      console.log('æäº¤è®¢å•ä¹‹å å†æ¬¡æ•°æ®ä¸ŠæŠ¥');
    });
};

const submitOrderAddTimeLog = timeLog(submitOrder);
const submitOrderAddTimeLogAndReportLog = reportLog(submitOrderAddTimeLog);
submitOrderAddTimeLogAndReportLog();

// æäº¤è®¢å•ä¹‹å‰ æ•°æ®ä¸ŠæŠ¥
// æäº¤è®¢å• å¼€å§‹è®¡æ—¶ 1618496989387
// æäº¤è®¢å• åŸé€»è¾‘
// æäº¤è®¢å• è€—æ—¶è®¡ç®— 2
// æäº¤è®¢å•ä¹‹å å†æ¬¡æ•°æ®ä¸ŠæŠ¥
```

è¿™æ ·å°±å®ç°äº†ï¼Œä¸ä¿®æ”¹åŸå‡½æ•°é€»è¾‘çš„åŒæ—¶ï¼Œæ‰©å±•ä¸€äº›æœªæ¥çš„åŠŸèƒ½ã€‚å‡½æ•°åå­—æ˜¯å–çš„é•¿äº†äº›ï¼Œä½†æ˜¯æ³¨é‡Šéƒ½çœå¾—å†™äº†~

## é«˜é˜¶å‡½æ•°åº”ç”¨

### æŸ¯é‡ŒåŒ–ä¸åæŸ¯é‡ŒåŒ–

#### æŸ¯é‡ŒåŒ–

æŸ¯é‡ŒåŒ–å°±æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå˜æ¢æˆæ¥å—å•å‚æ•°çš„å‡½æ•°ï¼Œå†…éƒ¨å†è¿”å›è°ƒç”¨ä¸‹ä¸€ä¸ªå•å‚æ•°çš„å‡½æ•°ã€‚ä¹¦ä¸­å®ç°äº†é€šç”¨çš„ currying å‡½æ•°ï¼Œè¿™ä¸ªæœ‰ç‚¹ä¸œè¥¿ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ ğŸ¤”

```js
/**
 * è¿™é‡Œå®ç°äº†ä¸€ä¸ªé€šç”¨çš„åŒ…è£…å‡½æ•°ï¼Œä¿å­˜argsçš„å¼•ç”¨
 * è°ƒç”¨æ—¶ä¼ é€’å‚æ•° åˆ™pushè¿›argsï¼ŒåŒæ—¶è¿”å›å½“å‰å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¿ç»­è°ƒç”¨ï¼‰
 * è°ƒç”¨æ—¶ä¸ä¼ å‚æ•° åˆ™ä½¿ç”¨argsæ‰§è¡Œä¼ å…¥çš„å‡½æ•°fn
 */

var currying = function(fn) {
  var args = [];
  return function() {
    if (arguments.length === 0) {
      return fn.apply(this, args);
    } else {
      [].push.apply(args, arguments);
      return arguments.callee;
    }
  };
};

// è¿™é‡Œä½¿ç”¨è‡ªæ‰§è¡Œå‡½æ•°åªæ˜¯ä¸ºäº†æ¨¡ä»¿å—çº§ä½œç”¨åŸŸ æ–¹ä¾¿ç†è§£å®Œå…¨å¯ä»¥æ”¹ä¸ºæ™®é€šå‡½æ•°
var cost = (function() {
  var money = 0;
  return function() {
    for (var i = 0, l = arguments.length; i < l; i++) {
      money += arguments[i];
    }
    return money;
  };
})();

var cost = currying(cost); // è½¬åŒ–æˆ currying å‡½æ•°
cost(100); // æœªçœŸæ­£æ±‚å€¼
cost(200); // æœªçœŸæ­£æ±‚å€¼
cost(300); // æœªçœŸæ­£æ±‚å€¼
// cost(100)(200)(300) è¿˜å¯ä»¥è¿™æ ·è°ƒç”¨
console.log(cost()); // æ±‚å€¼å¹¶è¾“å‡ºï¼š600
```

#### åæŸ¯é‡ŒåŒ–

åæŸ¯é‡ŒåŒ–å¦‚æœæŒ‰ç…§å­—é¢æ„æ€ï¼Œå°±æ˜¯æŠŠæ¥å—å•ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå˜æ¢æˆæ¥å—å¤šå‚æ•°çš„å‡½æ•°ã€‚  
è¿™æ ·ç†è§£ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯æ€»æ„Ÿè§‰å“ªé‡Œä¸å¯¹ï¼Œå¦å¤–ä¸€ç§æ›´é€šä¿—çš„è§£é‡Šæ˜¯å‡½æ•°çš„å€Ÿç”¨ï¼Œæ˜¯å‡½æ•°èƒ½å¤Ÿæ¥å—å¤„ç†å…¶ä»–å¯¹è±¡ï¼Œé€šè¿‡å€Ÿç”¨æ³›åŒ–ã€æ‰©å¤§äº†å‡½æ•°çš„ä½¿ç”¨èŒƒå›´ã€‚

```js
Function.prototype.uncurrying = function() {
  // self æ˜¯è°ƒç”¨uncurryingçš„å‡½æ•° ä¹Ÿå³æ˜¯Array.prototype.push
  var self = this;
  return function() {
    /**
     * argumentsæ˜¯pushä¼ å…¥çš„å‚æ•° [{"length": 1,"0": 1}, 2] (ç±»æ•°ç»„)
     * objæ˜¯ä»argumentsæˆªå–çš„ç¬¬ä¸€ä¸ªå‚æ•° {"length": 1,"0": 1}
     * æ­¤æ—¶argumentsä¸º[2](ç±»æ•°ç»„)
     */

    var obj = Array.prototype.shift.call(arguments);
    // Array.prototype.push.apply(obj, [2])
    return self.apply(obj, arguments);

    // åˆ†æä¸‹ä¹¦ä¸Šçš„å¦å¤–ä¸€ç§å®ç° æœ‰ç§è§£æ–¹ç¨‹çš„æ„Ÿè§‰
    // return Function.prototype.call.apply(self, arguments);
    /**
     * Function.prototype.call.apply(self, arguments)
     * -> (Function.prototype.call).apply(self, arguments)
     * -> (Function.prototype.call).call(self, obj, 2)
     * -> self.call(obj, 2)
     * -> Array.prototype.push.apply(obj, [2])
     */
  };
};

var push = Array.prototype.push.uncurrying();
var obj = {
  length: 1,
  '0': 1,
};
// pushä»æ¥æ”¶1ä¸ªå‚æ•° å˜ä¸ºæ¥æ”¶2ä¸ªå‚æ•°
push(obj, 2);
console.log(obj); // è¾“å‡ºï¼š{0: 1, 1: 2, length: 2}

// å¦‚æœcall.applyè®©ä½ æ— è¯­çš„è¯ï¼Œä¸‹é¢è¿™ä¸ªå°±æœ‰ç‚¹å´©æºƒäº†
var uncurrying = Function.prototype.uncurrying.uncurrying();
var pushAgain = uncurrying(Array.prototype.push);
pushAgain(obj, 2);
console.log(obj); // è¾“å‡ºï¼š{0: 1, 1: 2, length: 2}
```

> ä½ æ²¡æœ‰çœ‹é”™ï¼Œuncurrying è¿˜èƒ½å€Ÿç”¨è‡ªå·±ï¼Œè¿™ä¹Ÿè®¸å°±æ˜¯äººä»¬è¯´ js çµæ´»çš„åŸå› å§ã€‚
> å› ä¸º Function.prototype.uncurrying æ˜¯å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°çš„åŸå‹é“¾ä¸Šå¢åŠ äº† uncurrying æ–¹æ³•ï¼Œè¯•è¯•ä¸‹é¢è¿™ä¸ªä½ å°±çŸ¥é“ä¸ºä»€ä¹ˆäº†
> console.log(Function.prototype.uncurrying.uncurrying.uncurrying)
> åŸå‹é“¾å°±åƒé»‘æ´ï¼Œæ²¡æœ‰å°½å¤´ ğŸ˜’

### å‡½æ•°èŠ‚æµ throttle

åŸç†ï¼šä½¿ç”¨ setTimeout å»¶è¿Ÿæ‰§è¡Œï¼Œå¦‚æœè¯¥æ¬¡å»¶è¿Ÿæ‰§è¡Œè¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™å¿½ç•¥æ¥ä¸‹æ¥è°ƒç”¨è¯¥å‡½æ•°çš„è¯·æ±‚

```js
var throttle = function(fn, interval) {
  var __self = fn, // ä¿å­˜éœ€è¦è¢«å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°å¼•ç”¨
    timer, // å®šæ—¶å™¨
    firstTime = true; // æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨
  return function() {
    var args = arguments,
      __me = this;
    if (firstTime) {
      // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œä¸éœ€å»¶è¿Ÿæ‰§è¡Œ
      __self.apply(__me, args);
      return (firstTime = false);
    }
    if (timer) {
      // å¦‚æœå®šæ—¶å™¨è¿˜åœ¨ï¼Œè¯´æ˜å‰ä¸€æ¬¡å»¶è¿Ÿæ‰§è¡Œè¿˜æ²¡æœ‰å®Œæˆ
      return false;
    }
    timer = setTimeout(function() {
      // å»¶è¿Ÿä¸€æ®µæ—¶é—´æ‰§è¡Œ
      clearTimeout(timer);
      timer = null;
      __self.apply(__me, args);
    }, interval || 500);
  };
};
```

### åˆ†æ—¶å‡½æ•°

ä¹¦ä¸Šçš„ä¾‹å­æ˜¯åœ¨çŸ­æ—¶é—´å†…å¾€é¡µé¢ä¸­å¤§é‡æ·»åŠ  DOM èŠ‚ç‚¹ï¼Œä¼˜åŒ–ä¸ºæ¯éš”ä¸€æ®µæ—¶é—´åˆ›å»ºä¸€äº›èŠ‚ç‚¹ã€‚å…¶å®ä»”ç»†æƒ³ä¸‹ï¼Œæˆ‘ä»¬å¹³æ—¶çš„é¡¹ç›®ä¹Ÿæ˜¯è¿™æ ·ï¼Œåªä¸è¿‡è¿™ä¸ªäº‹æƒ…æ˜¯æ¡†æ¶åšçš„ã€‚

> react16 é‡‡ç”¨äº†æ—¶é—´ç‰‡çš„æ–¹å¼è§£å†³å¡é¡¿é—®é¢˜ï¼Œåªä¸è¿‡å®ƒåˆ†çš„æ›´ç»†ï¼Œä»¥å¸§ä¸ºå•ä½ï¼Œæ‰€ä»¥çœ‹ä¸Šå»æ¸²æŸ“å¾ˆæµç•…ã€‚

æ¨¡æ‹Ÿ react å®ç°åˆ†ç‰‡æ¸²æŸ“ï¼Œè¿™æ ·å°±ä¸ç”¨è®¾ç½®æ—¶é—´é—´éš”ï¼Œæµè§ˆå™¨ä¸å¿™çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œ

```js
var timeChunk = function(ary, fn, count) {
  var obj, t;
  var len = ary.length;
  var start = function() {
    for (var i = 0; i < Math.min(count || 1, ary.length); i++) {
      var obj = ary.shift();
      fn(obj);
    }
  };
  return function(deadline) {
    while (deadline.timeRemaining() > 0 || deadline.didTimeout) {
      start();
    }
    if (ary.length) {
      requestIdleCallback(arguments.callee);
    }
  };
};

var ary = [];
for (var i = 1; i <= 1000; i++) {
  ary.push(i);
}
var renderFriendList = timeChunk(
  ary,
  function(n) {
    var div = document.createElement('div');
    div.innerHTML = n;
    document.body.appendChild(div);
  },
  8,
);

requestIdleCallback(renderFriendList, { timeout: 2000 });
```

### æƒ°æ€§åŠ è½½

æ ¸å¿ƒæ˜¯å‡½æ•°é‡å†™ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡ŒååŸå‡½æ•°å°±è¢«æ›¿æ¢äº†

```js
var addEvent = function(elem, type, handler) {
  if (window.addEventListener) {
    addEvent = function(elem, type, handler) {
      elem.addEventListener(type, handler, false);
    };
  } else if (window.attachEvent) {
    addEvent = function(elem, type, handler) {
      elem.attachEvent('on' + type, handler);
    };
  }
  // ç¬¬ä¸€æ¬¡æ‰§è¡Œ é‡å†™addEvent = newFunction è°ƒç”¨newFunctionï¼Œåç»­ç›´æ¥æ‰§è¡ŒnewFunction
  addEvent(elem, type, handler);
};
```

[JS ä¸­çš„åæŸ¯é‡ŒåŒ–](https://segmentfault.com/a/1190000012912503)
[ç”¨ AOP æ”¹å–„ javascript ä»£ç ](http://www.alloyteam.com/2013/08/yong-aop-gai-shan-javascript-dai-ma/)
